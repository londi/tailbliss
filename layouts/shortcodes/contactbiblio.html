<style>

    .label-container {
        padding-top: 1.0rem;
    }

    input, textarea {
        width: 100%;
    }

    .status-label {
        padding-right: 1.0rem;
    }

    .successful {
        color: #78E2A0;
    }

    .failure {
        color: red;
    }

    .submit-button {
        padding-top: 0.5rem;
        display: flex;
        justify-content: flex-end;
        align-items: baseline;
    }
</style>
<form onsubmit="sendContact(event)">
    <div class="mb-3 label-container">
        <label for="emailInput" class="form-label">Enter your email address</label>
    </div>
    <div class="mb-3">
        <input type="email" required class="form-control" id="emailInput">
    </div>
    <div class="mb-3 label-container">
        <label for="subject" class="form-label">Subject</label>
    </div>
    <div class="mb-3">
        <select class="form-select" id="subject">
            <option value="no-subject-chosen" selected>Click here to choose your subject</option>
            <option value="general">General</option>
            <option value="feedback">Feedback</option>
            <option value="request-for-account-deletion">Delete my account</option>
        </select>
    </div>
    <div class="mb-3 label-container">
        <label for="messageInput" class="form-label">Enter your message</label>
    </div>
    <div class="mb-3">
        <textarea class="form-control" required id="messageInput" rows="3"></textarea>
    </div>

    <div class="mb-3 label-container">
        <label class="form-label">Please enter the result of the following complex calculation</label>
    </div>
    <div class="mb-3 label-container">
        <label for="captcha" class="form-label" id="captcha-task">1 + 2</label>
    </div>
    <div class="mb-3">
        <input type="text" required class="form-control" id="captcha">
    </div>

    <div class="mb-3 submit-button">
        <label for="captcha" class="form-label status-label" id="status-label"></label>
        <button type="submit" class="btn btn-primary" id="submit-button">Submit</button>
    </div>
</form>
<script>

    let n1 = -1;
    let n2 = -1;

    addEventListener("load", onLoad);

    function getRandomArbitrary(min, max) {
        return parseInt(Math.random() * (max - min) + min);
    }

    function onLoad(ev) {
        n1 = getRandomArbitrary(1, 10);
        n2 = getRandomArbitrary(5, 10);
        document.getElementById('captcha-task').innerText = `${n1} + ${n2}`;
    }

    async function sendContact(ev) {
        ev.preventDefault();

        const senderEmail = document.getElementById('emailInput').value;
        const senderSubject = document.getElementById('subject').value;
        const senderMessage = document.getElementById('messageInput').value;
        const captcha = document.getElementById('captcha').value;

        if (parseInt(captcha) !== n1 + n2) {
            // alert('The calculation is wrong.');
            document.getElementById('status-label').innerText = "The calculation is wrong.";
            document.getElementById('status-label').classList.remove("successful");
            document.getElementById('status-label').classList.add("failure");
            return;
        }

        // Disable submit button
        document.getElementById('submit-button').disabled = true

        const webhookBody = {
            message: senderMessage,
            fields: [
                {
                    name: 'email',
                    value: senderEmail
                },
                {
                    name: 'subject',
                    value: senderSubject
                }
            ],
            origin: 'biblio at leonluethi.com'
        };

        // Congrats! You've found the webhook url of this form!
        // If you want you can send me a custom message ;-)
        const webhookUrl = 'https://thonny.strubli.com/discord';

        const response = await fetch(webhookUrl, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(webhookBody),
        });

        if (response.ok) {
            // alert('Message sent!');
            document.getElementById('status-label').innerText = "message sent.";
            document.getElementById('status-label').classList.add("successful");
            document.getElementById('status-label').classList.remove("failure");
        } else {
            // alert('There was an error! Try again later.');
            document.getElementById('status-label').innerText = "There was an error! Try again later.";
            document.getElementById('status-label').classList.remove("successful");
            document.getElementById('status-label').classList.add("failure");
        }

        // Enable submit button
        document.getElementById('submit-button').disabled = false
    }

</script>